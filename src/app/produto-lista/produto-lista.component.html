<h2 class="section-title">Nossos Produtos</h2>

<ng-container *ngIf="produtosPorCategoria; else loading">
  <div *ngFor="let categoria of categorias" class="categoria-section">
    <h3 class="categoria-title">{{ categoria }}</h3>
    <div class="produto-grid">
      <div *ngFor="let produto of getProdutosPorCategoria(categoria).slice(0, 4)" class="produto-card" [routerLink]="['/produto', produto.id]">
        <div class="imagem-container">
          <ng-container *ngIf="produto.imagemCarregada; else loadingImagem">
            <img [src]="produto.imagem || imagemPadrao" [alt]="produto.nome" (load)="onImagemCarregada(produto)" (error)="onImagemErro(produto)">
          </ng-container>
          <ng-template #loadingImagem>
            <div class="loading-spinner"></div>
          </ng-template>
        </div>
        <h4 class="produto-nome">{{ produto.nome }}</h4>
        <p class="produto-preco">R$ {{ produto.preco.toFixed(2) }}</p>
      </div>
      <a *ngIf="deveExibirBotaoVerMais(categoria)" [routerLink]="['/categoria', categoria]" class="btn-ver-mais" aria-label="Ver mais produtos desta categoria">
        Ver mais
      </a>
    </div>
  </div>
</ng-container>

<ng-template #loading>
  <div class="loading-container">
    <div class="loading-spinner"></div>
    <p>Carregando produtos...</p>
  </div>
</ng-template>
